var w=(c,x,F)=>new Promise((o,E)=>{var k=m=>{try{v(F.next(m))}catch(r){E(r)}},I=m=>{try{v(F.throw(m))}catch(r){E(r)}},v=m=>m.done?o(m.value):Promise.resolve(m.value).then(k,I);v((F=F.apply(c,x)).next())});import{_ as Y,d as G,ad as J,r as f,w as j,K as l,L as n,h as z,H as q,a5 as e,I as t,ac as re,N as K,M as H,G as Q,aU as V,a$ as y,a6 as b,b0 as se,ab as ne,aJ as ce,a0 as W,a1 as X,a3 as g,b1 as de,b2 as ie,b3 as ue,aS as D,b4 as oe,j as he,a8 as P,e as R,a7 as M,b5 as pe,aZ as ve,Q as me,b6 as N,aa as ae,R as _e}from"./index.8eff2da7.js";import{I as O}from"./index.08a7cbc0.js";const le=c=>(W("data-v-53bde3a6"),c=c(),X(),c),ge={class:"media-preview"},ke={class:"medias"},ye={key:0,class:"media-video"},fe=["src"],Fe={class:"type-flag"},Ce={key:1,class:"media-image"},we=["src"],Ee={class:"type-flag"},Be={class:"indicators pf-medium"},Ae=le(()=>e("i",null,null,-1)),be=P("\u7ACB\u5373\u5206\u4EAB"),Te=[Ae,be],De=le(()=>e("div",{class:"share-text"},"\u5206\u4EAB\u65F6\u6587\u6848\u4F1A\u81EA\u52A8\u590D\u5236\uFF0C\u957F\u6309\u7C98\u8D34\u5373\u53EF",-1)),$e=G({props:{taskId:{type:Number},spuId:{type:Number},show:{type:Boolean,default:!1},medias:{type:Object,default(){return[]}},initial:{type:Number,default:0},copyText:{type:String,default:""}},emits:["update:show"],setup(c,{expose:x,emit:F}){const o=c,{taskId:E,spuId:k,show:I,medias:v,initial:m,copyText:r}=J(o),B=f(),p=f(I.value),A=f(m.value),S=f("");j(I,d=>{p.value=d}),j(p,d=>{F("update:show",d)}),j(m,d=>{A.value=d});const U=d=>{A.value=d},L=()=>w(this,null,function*(){g.loading({duration:0,forbidClick:!0,message:"\u52A0\u8F7D\u4E2D..."});const d=yield de(r.value),h=v.value[A.value];let i="",s="";if(h.materialType==y.BxPoster||h.materialType==y.Poster)try{S.value=yield ie({}),i=yield ue(h.picUrl,h.shareLink,S.value)}catch(_){i=h.picUrl}else h.materialType==y.Image?i=h.picUrl:h.materialType==y.Video&&(s=h.picUrl);d&&(g({message:`\u590D\u5236\u5206\u4EAB\u6587\u6848\u6210\u529F\uFF0C\u53EF\u7C98
\u8D34\u81F3\u8F93\u5165\u6846\u5185\u53D1\u9001\uFF5E`,duration:0}),yield D(1e3));const a=i?{mediaid:i}:void 0,u=s?{mediaid:s}:void 0;g("\u6A21\u62DF\u5206\u4EAB\u6210\u529F..."),yield D(1500),a?O([a.mediaid]):u&&oe({videoUrl:u.mediaid})});return x({quickShare:()=>w(this,null,function*(){if(v.value.length==0){g("\u6CA1\u6709\u7D20\u6750\u53EF\u4EE5\u5206\u4EAB");return}if(v.value.length==1){L();return}let d=0;v.value.find((i,s)=>i.materialType==y.Poster?(d=s,!0):!1)||v.value.find((i,s)=>i.materialType==y.BxPoster?(d=s,!0):!1),p.value=!0,he(()=>{B.value.swipeTo(d,{immediate:!0})})})}),(d,h)=>(l(),n("div",ge,[z(t(ce),{show:p.value,"onUpdate:show":h[1]||(h[1]=i=>p.value=i),"close-on-click-overlay":!1},{default:q(()=>[e("div",{class:"close",onClick:h[0]||(h[0]=i=>p.value=!1)}),e("div",ke,[z(t(re),{ref_key:"vanSwipe",ref:B,loop:!1,"show-indicators":!1,"initial-swipe":t(m),onChange:U},{default:q(()=>[(l(!0),n(K,null,H(t(v),(i,s)=>(l(),Q(t(ne),{key:s},{default:q(()=>[e("div",{class:V(["media",A.value==s&&"active"])},[i.materialType==t(y).Video?(l(),n("div",ye,[e("video",{src:`${i.picUrl}#t=0.1`,preload:"metadata",controls:""},null,8,fe),e("div",Fe,b(t(se)[i.materialType]),1)])):(l(),n("div",Ce,[e("img",{src:i.picUrl},null,8,we),e("div",Ee,b(t(se)[i.materialType]),1)]))],2)]),_:2},1024))),128))]),_:1},8,["initial-swipe"]),e("div",Be,b(A.value+1)+"/"+b(t(v).length),1)]),e("div",{class:"share"},[e("div",{class:"share-button",onClick:L},Te),De])]),_:1},8,["show"])]))}});var xe=Y($e,[["__scopeId","data-v-53bde3a6"]]);const $=c=>(W("data-v-fbe08b28"),c=c(),X(),c),Ie={class:"progress-text"},Se=$(()=>e("i",{class:"status"},null,-1)),Ue=$(()=>e("span",null,"\u8BDD\u672F\u5DF2\u81EA\u52A8\u4F20\u8F93",-1)),Pe=[Se,Ue],Le={class:"progress-media"},Me=$(()=>e("i",{class:"status"},null,-1)),Ne=$(()=>e("span",null,"\u751F\u6210\u5E26\u5458\u5DE5\u4FE1\u606F\u56FE\u7247\u7D20\u6750\uFF0C\u53EF\u8BB0\u5F55\u5230\u987E\u5BA2\u8BBF\u95EE\u548C\u9500\u552E",-1)),je=[Me,Ne],qe=$(()=>e("i",{class:"status"},null,-1)),Ve={key:0,class:"share-tip"},Oe={key:1,class:"progress-buttons"},ze=$(()=>e("i",null,null,-1)),Ke=P("\u5BA2\u6237 "),He=[ze,Ke],Re=$(()=>e("i",null,null,-1)),Ze=P("\u5BA2\u6237\u7FA4 "),Ye=[Re,Ze],Ge=$(()=>e("i",null,null,-1)),Je=P("\u670B\u53CB\u5708 "),Qe=[Ge,Je],We={key:2,class:"progress-tip pf-medium"},Xe=G({props:{taskId:{type:Number},spuId:{type:Number},medias:{type:Object,default(){return[]}},shareText:{type:String,default:""}},setup(c,{expose:x}){const F=c,{taskId:o,spuId:E,medias:k,shareText:I}=J(F),v=f(!1),m=f(""),r=f({shareText:0,medias:new Array(k.value.length).fill(0),mediasTotal:0}),B=R(()=>r.value.shareText!=0&&r.value.shareText!=1&&r.value.mediasTotal!=0&&r.value.mediasTotal!=1),p=f([]),A=R(()=>p.value.length==0||r.value.medias.some(s=>s==3));j(k,()=>{S()},{deep:!0});function S(){p.value=[],r.value={shareText:0,medias:new Array(k.value.length).fill(0),mediasTotal:0}}const U=s=>{let a="";switch(s){case 0:a="initial";break;case 1:a="processing";break;case 2:a="success";break;case 3:a="fail";break}return a},L=()=>w(this,null,function*(){S(),r.value.shareText=2,r.value.mediasTotal=1,m.value=yield ie({});for(const s in k.value){r.value.medias[s]=1;const a=k.value[s];let u=!1;if(a.materialType==y.BxPoster||a.materialType==y.Poster)try{const T=yield ue(a.picUrl,a.shareLink,m.value);p.value.push({msgtype:"image",image:{mediaid:T}}),u=!!T}catch(_){p.value.push({msgtype:"image",image:{imgUrl:a.picUrl}}),u=!0}else if(a.materialType==y.Image)p.value.push({msgtype:"image",image:{imgUrl:a.picUrl}}),u=!0;else if(a.materialType==y.Video){const _=a.picUrl;p.value.push({msgtype:"video",video:{mediaid:_}}),u=!!_}r.value.medias[s]=u?2:3}r.value.mediasTotal=2}),C=()=>w(this,null,function*(){A.value&&L(),v.value=!0}),d=()=>w(this,null,function*(){const s=[],a=[];p.value.forEach(u=>{var _,T,ee;u.msgtype=="image"&&(((_=u.image)==null?void 0:_.mediaid)||((T=u.image)==null?void 0:T.imgUrl))?s.push(u):u.msgtype=="video"&&((ee=u.video)==null?void 0:ee.mediaid)&&a.push(u)}),s.length>0&&a.length>0&&(g({message:"\u89C6\u9891\u4E0D\u80FD\u4E0E\u56FE\u7247\u540C\u65F6\u53D1\u8868\u670B\u53CB\u5708\uFF0C\u5DF2\u81EA\u52A8\u8FC7\u6EE4",duration:0,forbidClick:!0}),yield D(1500)),s.length>9&&(g({message:"\u56FE\u7247\u6700\u591A\u652F\u6301\u4E5D\u5F20\uFF0C\u5DF2\u81EA\u52A8\u4FDD\u7559\u524D\u4E5D\u5F20",duration:0,forbidClick:!0}),s.splice(9,s.length-9),yield D(1500)),a.length>1&&(g({message:"\u89C6\u9891\u53EA\u652F\u6301\u4E00\u4E2A\uFF0C\u5DF2\u81EA\u52A8\u4FDD\u7559\u7B2C\u4E00\u4E2A",duration:0,forbidClick:!0}),a.splice(1,1),yield D(1500)),g({message:"\u6B63\u5728\u524D\u5F80\u53D1\u9001\u9875...",duration:0,forbidClick:!0}),g("\u6A21\u62DF\u5206\u4EAB\u6210\u529F..."),yield D(1500),s.length>0?O(s.map(u=>{var _,T;return((_=u.image)==null?void 0:_.mediaid)||((T=u.image)==null?void 0:T.imgUrl)})):a.length>0&&oe({videoUrl:a[0].mediaid})}),h=()=>w(this,null,function*(){g({message:"\u6B63\u5728\u524D\u5F80\u53D1\u9001\u9875...",duration:0,forbidClick:!0}),g("\u6A21\u62DF\u7FA4\u53D1\u6210\u529F..."),yield D(1500),O(p.value.map(s=>{var a,u;return((a=s.image)==null?void 0:a.mediaid)||((u=s.image)==null?void 0:u.imgUrl)}))}),i=()=>w(this,null,function*(){g({message:"\u6B63\u5728\u524D\u5F80\u53D1\u9001\u9875...",duration:0,forbidClick:!0}),g("\u6A21\u62DF\u7FA4\u53D1\u6210\u529F..."),yield D(1500),O(p.value.map(s=>{var a,u;return((a=s.image)==null?void 0:a.mediaid)||((u=s.image)==null?void 0:u.imgUrl)}))});return x({shareToExternal:C}),(s,a)=>(l(),Q(t(ve),{class:"progress-overlay",show:v.value,onClick:a[1]||(a[1]=u=>t(B)&&(v.value=!1))},{default:q(()=>[e("div",{class:"progress-wrap",onClick:a[0]||(a[0]=pe(()=>{},["stop"]))},[e("div",Ie,[e("div",{class:V(["progress-total pf-medium",U(r.value.shareText)])},Pe,2)]),e("div",Le,[e("div",{class:V(["progress-total pf-medium",U(r.value.mediasTotal)])},je,2),(l(!0),n(K,null,H(r.value.medias,(u,_)=>(l(),n("div",{key:_,class:V(["progress-media-item",U(u)])},[e("span",null,"\u7B2C"+b(_+1)+"\u5F20",1),qe],2))),128))]),t(B)?(l(),n("div",Ve,"\u8BF7\u9009\u62E9\u53D1\u9001\u65B9\u5F0F")):M("",!0),t(B)?(l(),n("div",Oe,[e("div",{class:"share-contact-button pf-medium",onClick:h},He),e("div",{class:"share-chat-button pf-medium",onClick:i},Ye),e("div",{class:"share-moment-button pf-medium",onClick:d},Qe)])):(l(),n("div",We," \u6B63\u5728\u751F\u6210\u4E2D\uFF0C\u8BF7\u4FDD\u6301\u6253\u5F00\u72B6\u6001\u7A0D\u7B49... "))])]),_:1},8,["show"]))}});var es=Y(Xe,[["__scopeId","data-v-fbe08b28"]]),te="/static/logo-yunchan.9744e8c9.png",ss="/static/logo-chengzhangjia.44122450.png",as="/static/logo-ziying.c0d86665.png",ts="/static/logo-baoxian.4f0f08c9.png",is="/static/logo-huodong.bf4df800.png";const Z=c=>(W("data-v-2a962e3f"),c=c(),X(),c),us={class:"share-task-item"},os=["src"],ls={class:"task-detail"},rs={key:0,class:"task-title pf-medium"},ns={key:1,class:"task-tags"},cs={key:2,class:"task-time"},ds={key:3,class:"task-text"},hs={key:4,class:"task-materials"},ps=["onClick"],vs=["src"],ms=Z(()=>e("i",{class:"play-icon"},null,-1)),_s={class:"task-functions"},gs={class:"task-link"},ks=["href"],ys={key:1},fs=Z(()=>e("i",null,null,-1)),Fs=P("\u5206\u4EAB"),Cs=[fs,Fs],ws=Z(()=>e("i",null,null,-1)),Es=P("\u7FA4\u53D1 "),Bs=[ws,Es],As=Z(()=>e("i",null,null,-1)),bs=P("\u8BE6\u60C5"),Ts=[As,bs],Ds=G({props:{cityId:{type:[String,Number],default(){return me.cityId}},task:{type:Object,default(){return{}}},slices:{type:Number,default:void 0}},setup(c){const x=c,{cityId:F,task:o}=J(x),E=f(!1),k=f(0),I=R(()=>{switch(o.value.businessType){case N.Yunchan:return te;case N.Chengzhangjia:return ss;case N.Ziying:return as;case N.Baoxian:return ts;case N.Huodong:return is;default:return te}}),v=R(()=>{if(o.value.detailLink){const C=ae.parseUrl(o.value.detailLink);return C.query.kwtarget="blank",ae.stringifyUrl(C)}else return"javascript:;"}),m=()=>{},r=f(),B=f(),p=()=>w(this,null,function*(){r.value.quickShare()}),A=()=>w(this,null,function*(){B.value.shareToExternal()}),S=()=>{location.href=`/share-service/task/${o.value.id}?cityId=${F.value}`},U=C=>{E.value=!0,k.value=C},L=C=>{E.value=!0,k.value=C};return(C,d)=>{const h=_e("BaseImg");return l(),n("div",us,[e("img",{class:"task-logo",src:t(I)},null,8,os),e("div",ls,[t(o).title?(l(),n("div",rs,b(t(o).title),1)):M("",!0),t(o).sharePeople?(l(),n("div",ns,[(l(!0),n(K,null,H(t(o).sharePeople.split(","),(i,s)=>(l(),n("div",{key:s,class:"task-tag"},b(i),1))),128))])):M("",!0),t(o).endTime?(l(),n("div",cs," \u6D3B\u52A8\u622A\u6B62\u65E5\u671F\uFF1A"+b(t(o).endTime),1)):M("",!0),t(o).shareArticle?(l(),n("div",ds,b(t(o).shareArticle),1)):M("",!0),t(o).shareMaterialList?(l(),n("div",hs,[(l(!0),n(K,null,H(t(o).shareMaterialList.slice(0,c.slices),(i,s)=>(l(),n("div",{key:s,class:"task-material"},[i.materialType==t(y).Video?(l(),n("div",{key:0,class:"task-video",onClick:a=>L(s)},[e("video",{src:`${i.picUrl}#t=0.1`,preload:"metadata"},null,8,vs),ms],8,ps)):(l(),Q(h,{key:1,src:i.picUrl,width:160,height:160,onClick:a=>U(s)},null,8,["src","onClick"]))]))),128))])):M("",!0),e("div",_s,[e("div",gs,[t(o).detailLink?(l(),n("a",{key:0,href:t(v),onClick:m},"\u67E5\u770B\u94FE\u63A5",8,ks)):(l(),n("div",ys))]),e("div",{class:"task-buttons"},[e("div",{class:"task-quick-button",onClick:p},Cs),e("div",{class:"workchat-send-button",onClick:A},Bs),e("div",{class:"task-share-button",onClick:S},Ts)])])]),z(xe,{ref_key:"mediasPreview",ref:r,show:E.value,"onUpdate:show":d[0]||(d[0]=i=>E.value=i),"task-id":t(o).id,medias:t(o).shareMaterialList,initial:k.value,"copy-text":t(o).shareArticle},null,8,["show","task-id","medias","initial","copy-text"]),z(es,{ref_key:"mediasExternal",ref:B,"task-id":t(o).id,medias:t(o).shareMaterialList,"share-text":t(o).shareArticle},null,8,["task-id","medias","share-text"])])}}});var Ss=Y(Ds,[["__scopeId","data-v-2a962e3f"]]);export{Ss as S};
//# sourceMappingURL=ShareServiceTaskItem.2fa23e14.js.map
