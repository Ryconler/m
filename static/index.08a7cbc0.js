var D=Math.pow;import{c as _,d as F,an as b,n as k,x as L,u as Q,e as Z,w as X,h as r,aG as ee,ab as oe,p as A,aH as p,Z as te,r as ae,g as se,o as ne,ar as ie,aI as ce,j as le,ac as re,ax as q,ay as me,aJ as ue,t as H,aK as ve,ao as z,aD as $,V as B,q as de,aA as ge,aL as he,Y as fe,aM as we,z as xe,C as Pe,aN as Ce,aO as ye}from"./index.8eff2da7.js";const E=o=>Math.sqrt(D(o[0].clientX-o[1].clientX,2)+D(o[0].clientY-o[1].clientY,2)),O=_("image-preview")[1];var Ie=F({props:{src:String,show:Boolean,active:Number,minZoom:b(k),maxZoom:b(k),rootWidth:b(Number),rootHeight:b(Number)},emits:["scale","close"],setup(o,{emit:c}){const e=L({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),l=Q(),i=Z(()=>{const{rootWidth:t,rootHeight:s}=o,n=s/t;return e.imageRatio>n}),I=Z(()=>{const{scale:t,moveX:s,moveY:n,moving:m,zooming:C}=e,Y={transitionDuration:C||m?"0s":".3s"};if(t!==1){const G=s/t,J=n/t;Y.transform=`scale(${t}, ${t}) translate(${G}px, ${J}px)`}return Y}),g=Z(()=>{if(e.imageRatio){const{rootWidth:t,rootHeight:s}=o,n=i.value?s/e.imageRatio:t;return Math.max(0,(e.scale*n-t)/2)}return 0}),u=Z(()=>{if(e.imageRatio){const{rootWidth:t,rootHeight:s}=o,n=i.value?s:t*e.imageRatio;return Math.max(0,(e.scale*n-s)/2)}return 0}),h=t=>{t=p(t,+o.minZoom,+o.maxZoom+1),t!==e.scale&&(e.scale=t,c("scale",{scale:t,index:o.active}))},v=()=>{h(1),e.moveX=0,e.moveY=0},W=()=>{const t=e.scale>1?1:2;h(t),e.moveX=0,e.moveY=0};let f,w,x,S,T,a,P;const d=t=>{const{touches:s}=t,{offsetX:n}=l;l.start(t),f=s.length,w=e.moveX,x=e.moveY,P=Date.now(),e.moving=f===1&&e.scale!==1,e.zooming=f===2&&!n.value,e.zooming&&(S=e.scale,T=E(t.touches))},K=t=>{const{touches:s}=t;if(l.move(t),(e.moving||e.zooming)&&A(t,!0),e.moving){const{deltaX:n,deltaY:m}=l,C=n.value+w,Y=m.value+x;e.moveX=p(C,-g.value,g.value),e.moveY=p(Y,-u.value,u.value)}if(e.zooming&&s.length===2){const n=E(s),m=S*n/T;h(m)}},U=()=>{if(f>1)return;const{offsetX:t,offsetY:s}=l,n=Date.now()-P,m=250,C=5;t.value<C&&s.value<C&&n<m&&(a?(clearTimeout(a),a=null,W()):a=setTimeout(()=>{c("close"),a=null},m))},N=t=>{let s=!1;(e.moving||e.zooming)&&(s=!0,e.moving&&w===e.moveX&&x===e.moveY&&(s=!1),t.touches.length||(e.zooming&&(e.moveX=p(e.moveX,-g.value,g.value),e.moveY=p(e.moveY,-u.value,u.value),e.zooming=!1),e.moving=!1,w=0,x=0,S=1,e.scale<1&&v(),e.scale>o.maxZoom&&(e.scale=+o.maxZoom))),A(t,s),U(),l.reset()},V=t=>{const{naturalWidth:s,naturalHeight:n}=t.target;e.imageRatio=n/s};return X(()=>o.active,v),X(()=>o.show,t=>{t||v()}),()=>{const t={loading:()=>r(te,{type:"spinner"},null)};return r(oe,{class:O("swipe-item"),onTouchstart:d,onTouchmove:K,onTouchend:N,onTouchcancel:N},{default:()=>[r(ee,{src:o.src,fit:"contain",class:O("image",{vertical:i.value}),style:I.value,onLoad:V},t)]})}}});const[Se,y]=_("image-preview"),Te=["show","transition","overlayStyle","closeOnPopstate"],pe={show:Boolean,loop:H,images:ve(),minZoom:z(1/3),maxZoom:z(3),overlay:H,closeable:Boolean,showIndex:H,className:$,closeIcon:B("clear"),transition:String,beforeClose:Function,overlayClass:$,overlayStyle:Object,swipeDuration:z(300),startPosition:z(0),showIndicators:Boolean,closeOnPopstate:H,closeIconPosition:B("top-right")};var j=F({name:Se,props:pe,emits:["scale","close","closed","change","update:show"],setup(o,{emit:c,slots:e}){const l=ae(),i=L({active:0,rootWidth:0,rootHeight:0}),I=()=>{if(l.value){const a=de(l.value.$el);i.rootWidth=a.width,i.rootHeight=a.height,l.value.resize()}},g=a=>c("scale",a),u=a=>c("update:show",a),h=()=>{ge(o.beforeClose,{args:[i.active],done:()=>u(!1)})},v=a=>{a!==i.active&&(i.active=a,c("change",a))},W=()=>{if(o.showIndex)return r("div",{class:y("index")},[e.index?e.index({index:i.active}):`${i.active+1} / ${o.images.length}`])},f=()=>{if(e.cover)return r("div",{class:y("cover")},[e.cover()])},w=()=>r(re,{ref:l,lazyRender:!0,loop:o.loop,class:y("swipe"),duration:o.swipeDuration,initialSwipe:o.startPosition,showIndicators:o.showIndicators,indicatorColor:"white",onChange:v},{default:()=>[o.images.map(a=>r(Ie,{src:a,show:o.show,active:i.active,maxZoom:o.maxZoom,minZoom:o.minZoom,rootWidth:i.rootWidth,rootHeight:i.rootHeight,onScale:g,onClose:h},null))]}),x=()=>{if(o.closeable)return r(fe,{role:"button",name:o.closeIcon,class:[y("close-icon",o.closeIconPosition),he],onClick:h},null)},S=()=>c("closed"),T=(a,P)=>{var d;return(d=l.value)==null?void 0:d.swipeTo(a,P)};return se({swipeTo:T}),ne(I),X([ie,ce],I),X(()=>o.startPosition,a=>v(+a)),X(()=>o.show,a=>{const{images:P,startPosition:d}=o;a?(v(+d),le(()=>{I(),T(+d,{immediate:!0})})):c("close",{index:i.active,url:P[i.active]})}),()=>r(ue,q({class:[y(),o.className],overlayClass:[y("overlay"),o.overlayClass],onClosed:S,"onUpdate:show":u},me(o,Te)),{default:()=>[x(),w(),W(),f()]})}});let R;const Xe={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function Ye(){({instance:R}=Ce({setup(){const{state:o,toggle:c}=ye(),e=()=>{o.images=[]};return()=>r(j,q(o,{onClosed:e,"onUpdate:show":c}),null)}}))}const M=(o,c=0)=>{if(!!we)return R||Ye(),o=Array.isArray(o)?{images:o,startPosition:c}:o,R.open(xe({},Xe,o)),R};M.Component=Pe(j);M.install=o=>{o.use(M.Component)};export{M as I};
//# sourceMappingURL=index.08a7cbc0.js.map
