var P=Object.defineProperty,b=Object.defineProperties;var S=Object.getOwnPropertyDescriptors;var d=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var f=(o,n,e)=>n in o?P(o,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[n]=e,m=(o,n)=>{for(var e in n||(n={}))v.call(n,e)&&f(o,e,n[e]);if(d)for(var e of d(n))x.call(n,e)&&f(o,e,n[e]);return o},p=(o,n)=>b(o,S(n));var u=(o,n,e)=>new Promise((t,l)=>{var i=r=>{try{c(e.next(r))}catch(s){l(s)}},a=r=>{try{c(e.throw(r))}catch(s){l(s)}},c=r=>r.done?t(r.value):Promise.resolve(r.value).then(i,a);c((e=e.apply(o,n)).next())});import{S as w}from"./storage.ab874d93.js";import{l as y}from"./storage.f0e80fa9.js";var C=function(n,e,t){var l=document.head||document.getElementsByTagName("head")[0],i=document.createElement("script");typeof e=="function"&&(t=e,e={}),e=e||{},t=t||function(){},i.type=e.type||"text/javascript",i.charset=e.charset||"utf8",i.async="async"in e?!!e.async:!0,i.src=n,e.attrs&&E(i,e.attrs),e.text&&(i.text=""+e.text);var a="onload"in i?g:L;a(i,t),i.onload||g(i,t),l.appendChild(i)};function E(o,n){for(var e in n)o.setAttribute(e,n[e])}function g(o,n){o.onload=function(){this.onerror=this.onload=null,n(null,o)},o.onerror=function(){this.onerror=this.onload=null,n(new Error("Failed to load "+this.src),o)}}function L(o,n){o.onreadystatechange=function(){this.readyState!="complete"&&this.readyState!="loaded"||(this.onreadystatechange=null,n(null,o))}}function h(){return u(this,null,function*(){function o(){return new Promise((e,t)=>{window.AMap&&window.AMap.Map?e(window.AMap):C("//webapi.amap.com/maps?v=1.4.15&key=c740e64858e21be917b7a68d264f60bd&callback=onAMapLoaded",l=>{l?t(null):window.onAMapLoaded=()=>{e(window.AMap)}})})}const n=yield o();return new Promise((e,t)=>{try{n?new n.Map("iCenter").plugin("AMap.Geolocation",()=>{const i=new n.Geolocation({enableHighAccuracy:!0,timeout:5e3,buttonOffset:new n.Pixel(10,20),zoomToAccuracy:!0,buttonPosition:"RB"});i.getCurrentPosition(),n.event.addListener(i,"complete",a=>{if(console.log("geolocation",a),a&&a.addressComponent&&a.position){const c=a.addressComponent.adcode,r=a.addressComponent.city,s=r?r.replace("\u5E02",""):"",A=a.position.lat,M=a.position.lng;e(c?{cityId:c,cityName:s,lat:A,lng:M}:null)}else e(null)}),n.event.addListener(i,"error",a=>{console.error("geolocation error",a),t(null)})}):e(null)}catch(l){console.error(l),t(null)}})})}function B(o=30){return u(this,null,function*(){try{const n=y.getItem(w.Position),e=Date.now();let t;return n?e-n.time<o*60*1e3?t=n:t=yield h():t=yield h(),t&&y.setItem(w.Position,p(m({},t),{time:Date.now()})),t}catch(n){return null}})}export{B as g};
//# sourceMappingURL=position.4bbb72b2.js.map
