var P=Object.defineProperty,k=Object.defineProperties;var b=Object.getOwnPropertyDescriptors;var f=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var m=(n,e,t)=>e in n?P(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,p=(n,e)=>{for(var t in e||(e={}))x.call(e,t)&&m(n,t,e[t]);if(f)for(var t of f(e))E.call(e,t)&&m(n,t,e[t]);return n},v=(n,e)=>k(n,b(e));var u=(n,e,t)=>new Promise((o,a)=>{var i=l=>{try{s(t.next(l))}catch(r){a(r)}},c=l=>{try{s(t.throw(l))}catch(r){a(r)}},s=l=>l.done?o(l.value):Promise.resolve(l.value).then(i,c);s((t=t.apply(n,e)).next())});import{r as d,o as I,O as L,P as y,d as B,K as O,h as D,Q as K,J as j}from"./index.b2407a93.js";import{g as M,s as S}from"./city.4384b01b.js";import{S as h,C as G}from"./storage.2d44022f.js";import{l as w}from"./storage.f0e80fa9.js";var H=function(e,t,o){var a=document.head||document.getElementsByTagName("head")[0],i=document.createElement("script");typeof t=="function"&&(o=t,t={}),t=t||{},o=o||function(){},i.type=t.type||"text/javascript",i.charset=t.charset||"utf8",i.async="async"in t?!!t.async:!0,i.src=e,t.attrs&&R(i,t.attrs),t.text&&(i.text=""+t.text);var c="onload"in i?g:T;c(i,o),i.onload||g(i,o),a.appendChild(i)};function R(n,e){for(var t in e)n.setAttribute(t,e[t])}function g(n,e){n.onload=function(){this.onerror=this.onload=null,e(null,n)},n.onerror=function(){this.onerror=this.onload=null,e(new Error("Failed to load "+this.src),n)}}function T(n,e){n.onreadystatechange=function(){this.readyState!="complete"&&this.readyState!="loaded"||(this.onreadystatechange=null,e(null,n))}}function C(){return u(this,null,function*(){function n(){return new Promise((t,o)=>{window.AMap&&window.AMap.Map?t(window.AMap):H("//webapi.amap.com/maps?v=1.4.15&key=c740e64858e21be917b7a68d264f60bd&callback=onAMapLoaded",a=>{a?o(null):window.onAMapLoaded=()=>{t(window.AMap)}})})}const e=yield n();return new Promise((t,o)=>{try{e?new e.Map("iCenter").plugin("AMap.Geolocation",()=>{const i=new e.Geolocation({enableHighAccuracy:!0,timeout:5e3,buttonOffset:new e.Pixel(10,20),zoomToAccuracy:!0,buttonPosition:"RB"});i.getCurrentPosition(),e.event.addListener(i,"complete",c=>{if(console.log("geolocation",c),c&&c.addressComponent&&c.position){const s=c.addressComponent.adcode,l=c.addressComponent.city,r=l?l.replace("\u5E02",""):"",N=c.position.lat,_=c.position.lng;t(s?{cityId:s,cityName:r,lat:N,lng:_}:null)}else t(null)}),e.event.addListener(i,"error",c=>{console.error("geolocation error",c),o(null)})}):t(null)}catch(a){console.error(a),o(null)}})})}function A(n=30){return u(this,null,function*(){try{const e=w.getItem(h.Position),t=Date.now();let o;return e?t-e.time<n*60*1e3?o=e:o=yield C():o=yield C(),o&&w.setItem(h.Position,v(p({},o),{time:Date.now()})),o}catch(e){return null}})}const z=()=>{const n=d(null),e=d(y),t=d(!1);return I(()=>u(void 0,null,function*(){const o=L.get(G.City);if(o){const a=o.split("_");e.value={cityId:a[0],cityName:decodeURIComponent(a[1])}}else{const a=yield M();a!=null?e.value=a:(n.value=yield A(),n.value!=null?e.value={cityId:n.value.cityId,cityName:n.value.cityName}:e.value=y)}S(e.value.cityId,e.value.cityName),n.value==null?A().then(a=>{n.value=a,t.value=!0}):t.value=!0})),{position:n,cityInfo:e,locationLoaded:t}},F={class:"search"},X=B({setup(n){const e=d(y);return I(()=>u(this,null,function*(){const t=M();if(t)e.value=t;else{const{position:o}=yield z();o.value!=null?e.value={cityId:o.value.cityId,cityName:o.value.cityName}:e.value=y,S(e.value.cityId,e.value.cityName)}})),(t,o)=>{const a=K("SearchBar");return j(),O("div",F,[D(a,{"is-searching":""})])}}});export{X as default};
//# sourceMappingURL=Search.c845c17c.js.map
